$(function(){function e(){_.transaction(function(e){e.executeSql('SELECT * FROM pclist WHERE pIndex = "pContent"',[],function(e,t){if(console.log("查询数据成功!"),t.rows.length>0){var i=t.rows[0].pStr;$(".mobiReview").html(i);new Swiper(".swiper-container",{pagination:".pagination",autoplay:2e3,speed:300,loop:!0,observer:!0,observeParents:!0,autoplayDisableOnInteraction:!1})}},function(e,t){console.log(t.source+"::"+t.message)})})}function t(t,i,a){_.transaction(function(n){n.executeSql("INSERT INTO pclist VALUES(?,?,?)",[t,i,a],function(t,i){console.log("成功保存数据!"),e()},function(e,t){console.log(t.source+"::"+t.message)})})}function i(e,i,a){_.transaction(function(n){n.executeSql("DELETE FROM pclist where pIndex=?",[e],function(n){console.log("删除数据成功!"),t(e,i,a)},function(e,t){console.log(t.source+"::"+t.message)})})}function a(e,t,a){i(e,g,a)}function n(){$(".more_pic").ace_file_input({style:"well",no_icon:"",btn_choose:"点击选择",btn_change:null,icon_remove:"ace-icon fa fa-times",droppable:!0,thumbnail:"small",maxSize:307200,allowExt:["jpeg","jpg","png","gif"],allowMime:["image/jpg","image/jpeg","image/png","image/gif"],before_remove:function(){return!w}})}function o(e){var t="";return t+='<tr class="image_item">',0==e&&(t+='<td style="vertical-align: middle;">',t+='<input class="floor_id" type="text" name="floor_id[]" placeholder="楼层ID" style="width:100px;">',t+=" </td>"),t+='<td style="vertical-align: middle;">',t+='<input class="sku_id" type="text" name="sku_id[]" placeholder="skuid/其他" style="width:100px;">',t+=" </td>",t+='<td style="vertical-align: middle;max-width:180px;">',t+='<input  type="file" class="more_pic" name="more_pic[]" multiple="" >',t+="</td>",t+='<td style="vertical-align: middle;">',t+='<select class="pic_target" name="pic_target[]">',t+=' <option value="0">无</option>',t+='<option value="1">商品</option>',t+='<option value="2">店铺</option>',t+='<option value="3">专题活动页</option>',t+='<option value="4">其他自定义</option>',t+=" </select>",t+=" </td>",t+='<td style="vertical-align: middle;">',t+='<input class="pic_link" type="text" value="http://" name="pic_link[]" placeholder="http://" style="min-width:350px;">',t+="</td>",t+='<td style="vertical-align: middle;text-align:center;">',t+='<i class="item_del red ace-icon fa fa-trash-o bigger-150"></i>',t+="</td>",t+="</tr>"}function l(e){$(e).on("change",".pic_target",function(){var e=parseInt($(this).val()),t=$(this).parents("tr").find(".sku_id"),i=$(this).parent("td").next("td").find("input");switch(e){case 0:i.attr("readonly","readonly"),i.val("");break;case 1:i.attr("readonly","readonly"),i.val(S+t.val()+".html");break;case 2:i.attr("readonly","readonly"),i.val(C+t.val()+".html");break;case 3:i.attr("readonly","readonly"),i.val(P+t.val()+".html");break;case 4:i.removeAttr("readonly"),i.val("http://")}})}function d(e){$(e).on("click",".item_del",function(){$(this).parents("tr").remove()})}function s(e){$(e).on("blur",".sku_id",function(){var e=$(this),t=/^[0-9a-zA-a]*$/g,i=$(this).val();if(t.test(i)){var a=parseInt(e.parent().siblings(".target_link").prev().find(".pic_target").val()),n=e.parent().siblings(".target_link").find("input");switch(console.log(i),console.log(a),a){case 0:n.attr("readonly","readonly"),n.val("");break;case 1:n.attr("readonly","readonly"),n.val(S+i+".html");break;case 2:n.attr("readonly","readonly"),n.val(C+i+".html");break;case 3:n.attr("readonly","readonly"),n.val(P+i+".html");break;case 4:n.removeAttr("readonly"),n.val("http://")}}else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("请输入数字、字母!"),$(this).val("")})}function r(e){var t=e.parents(".image_item"),i=e.val();$.ajax({url:"/pc/checksku.html",type:"POST",dataType:"json",async:!1,data:{sku_id:i},success:function(i){"success"!=i.msg?($(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("商品sku错误!"),e.val(""),t.find(".goodsimglogo").attr("src",""),t.find(".goodsname").html(""),t.find(".goodsshopprice").html(""),t.find(".goodsmarketprice").html("")):"success"==i.msg&&(t.find(".goodsimglogo").attr("src",i.data.S_Logo),t.find(".goodsname").html(i.data.S_Name),t.find(".goodsshopprice").html(i.data.S_MarketPrice),t.find(".goodsmarketprice").html(i.data.S_ShopPrice))}})}function c(e){var t=e.parents(".modal").find(".modal-body").find(".image_content"),i=[];t.find(".sku_id").each(function(){i.push($(this).val())});var a=[];t.find("tr").each(function(){var e=$(this).find("label").find("img").attr("class");void 0!=e&&a.push(e)});var n=a.length,o=parseInt(n),l=parseInt(t.parents(".modal-body").find(".display_more_pic").find("li").length);return{arrTbVal:i,arrTbImg:a,numTbLen:o,ulTbLen:l}}function p(e){return'<tr class="image_item"><td style="vertical-align: middle;text-align: center;"> '+e+' </td><td style="vertical-align: middle;text-align: center;"><input class="floor_id" type="text" name="floor_id" placeholder="楼层ID" style="min-width: 80px;"></td><td style="vertical-align: middle;"><input class="floor_name" type="text" name="floor_name" placeholder="楼层名称" style="min-width: 320px;"></td> <td style="vertical-align: middle;text-align:center;"><i class="item_del red ace-icon fa fa-trash-o bigger-150"></i></td></tr>'}function m(e){var t="";return t+='<div class="modulePanelBg">',t+='<button data-toggle="modal" data-target="#setStyle" class="set_module btn btn-primary btn-xs ">设置样式</button>',t+="</div>"}function f(e){var t="";return t+='<div class="modulePanelBg">',t+='<button data-toggle="modal" data-target="#modalEdit" class="edit_module btn btn-primary btn-xs ">编辑模块</button>',t+='<button data-toggle="modal" data-target="#setStyle" class="set_module btn btn-primary btn-xs ">设置样式</button>',t+='<div class="moduleBtn action-buttons">',t+='<span class="module_del"><a><i class="fa fa-times" aria-hidden="true"></i></a></span>',0!=e&&(t+='<span class="module_up"><a><i class="fa fa-long-arrow-up" aria-hidden="true"></i></a></span>'),t+='<span class="module_down"><a><i class="fa fa-long-arrow-down" aria-hidden="true"></i></a></span>',t+="</div>",t+="</div>"}function h(){return'<a class="moduleItemBg"><span data-toggle="modal" data-target="#setStyle" class="moduleItemEdit"><i class="fa fa-pencil" aria-hidden="true"></i></span><span class="moduleItemDel"><i class="fa fa-times" aria-hidden="true"></i></span></a>'}function u(e,t,i){var a=e.parent(".modal-footer").prev(".modal-body"),n=new RegExp("px","g"),o="",l="",d="",s="",r="";1==a.find("input[name=border_style]:checked").val()?(o=a.find("input[name=border_color]").val(),l=a.find("select[name=border_width]").val(),d=a.find("select[name=border_style]").val(),s=a.find("select[name=border_radius]").val()):(r=t.css("border"),s=t.css("border-radius").replace(n,"")),o=""==o?"#fff":o,""==l?l="0px":l+="px",d=""==d?"none":d,""==s?s="0":s+="px",r=""==r?o+" "+l+" "+d:r;var c="";c=1==a.find("input[name=height_style]:checked").val()?-1==(c=""==(c=a.find("input[name=height]").val())?t.css("height"):c).indexOf("%")?c.replace(n,"")+"px":c:t.css("height");var p="",m="",f="",h="",u="";1==a.find("input[name=margin_style]:checked").val()?(p=a.find("input[name=margin_left]").val(),m=a.find("input[name=margin_right]").val(),f=a.find("input[name=margin_top]").val(),h=a.find("input[name=margin_down]").val(),p=""==p?t.css("margin-left"):p,m=""==m?t.css("margin-right"):m,f=""==f?t.css("margin-top"):f,h=""==h?t.css("margin-bottom"):h,p=-1==p.indexOf("%")?p.replace(n,"")+"px":p,m=-1==m.indexOf("%")?m.replace(n,"")+"px":m,f=-1==f.indexOf("%")?f.replace(n,"")+"px":f,h=-1==h.indexOf("%")?h.replace(n,"")+"px":h):u=t.css("margin"),u=""==u?f+" "+m+" "+h+" "+p:u;var v="",g="",_="",$="",b="";1==a.find("input[name=padding_style]:checked").val()?(v=a.find("input[name=padding_left]").val(),g=a.find("input[name=padding_right]").val(),_=a.find("input[name=padding_top]").val(),$=a.find("input[name=padding_down]").val(),v=""==v?t.css("padding-left"):v,g=""==g?t.css("padding-right"):g,_=""==_?t.css("padding-top"):_,$=""==$?t.css("padding-bottom"):$,v=-1==v.indexOf("%")?v.replace(n,"")+"px":v,g=-1==g.indexOf("%")?g.replace(n,"")+"px":g,_=-1==_.indexOf("%")?_.replace(n,"")+"px":_,$=-1==$.indexOf("%")?$.replace(n,"")+"px":$):b=t.css("padding"),b=""==b?_+" "+g+" "+$+" "+v:b;var y="",x="";1==a.find("input[name=font_style]:checked").val()?(y=a.find("input[name=font_color]").val(),x=a.find("input[name=font_size]").val().replace(n,"")+"px"):(y=t.css("color"),x=t.css("font-size"));var w="",k="",I="",S="",C="";if(1==a.find("input[name=bg_style]:checked").val())switch(w=a.find("input[name=bg_color]").val(),k=a.find(".display_more_pic").find("li").attr("data-identify"),I="url("+k+")",bgpic_style=parseInt(a.find("select[name=bgpic_style]").val()),bgpic_style){case 0:S="100% 100%",C="no-reapt";break;case 1:C="no-reapt";break;case 2:C="repeat-x";break;case 3:C="repeat-y"}else w=t.css("background-color"),I=t.css("background-url"),S=t.css("background-size"),C=t.css("background-reapt");if("LI"==t[0].nodeName){var P=a.find("input[name=width_style]:checked").val(),T=t.parent("ul").css("width").replace(n,""),R="";1==P?-1==(R=-1==(R=""==(R=a.find("input[name=li_width]").val())?t.css("width"):R).indexOf("%")?R.replace(n,""):R).indexOf("%")||(R=R):R=t.css("width").replace(n,"")/T*100+"%";var E=a.find("input[name=item_picw_style]:checked").val(),O=t.css("width").replace(n,""),B="";B=1==E?-1==(B=-1==(B=""==(B=a.find("input[name=li_img_width]").val())?t.find("img").css("width"):B).indexOf("%")?B.replace(n,""):B).indexOf("%")?B/O*100+"%":B:(B=t.find("img").css("width").replace(n,""))/O*100+"%";var z="";z=1==(E=a.find("input[name=item_pic_style]:checked").val())?-1==(z=""==(z=a.find("input[name=li_img_height]").val())?t.find("img").css("height"):z).indexOf("%")?z.replace(n,"")+"px":z:t.find("img").css("height");var L="",A="",j="",D="";1==a.find("input[name=head_style]:checked").val()?(L=a.find("input[name=head_font_color]").val(),A=a.find("input[name=head_font_size]").val().replace(n,"")+"px",j=2*a.find("input[name=head_font_size]").val().replace(n,"")+"px",D=A):(L=t.find("p").css("color"),void 0!=(A=t.find("p").css("font-size"))&&(j=t.find("p").css("height"),D=A));var M="",q="",F="",N="";1==a.find("input[name=price_style]:checked").val()?(M=a.find("input[name=price_font_color]").val(),q=a.find("input[name=price_font_size]").val().replace(n,"")+"px",F=parseInt(q.replace(n,""))+2+"px",N=parseInt(q.replace(n,""))+2+"px"):(M=t.find(".pro_vip_price").css("color"),void 0!=(q=t.find(".pro_vip_price").css("font-size"))&&(F=parseInt(q.replace(n,""))+2+"px",N=parseInt(q.replace(n,""))+2+"px"));var H="",V="",W="",X="";1==a.find("input[name=cost_style]:checked").val()?(H=a.find("input[name=cost_font_color]").val(),V=a.find("input[name=cost_font_size]").val().replace(n,"")+"px",W=parseInt(V.replace(n,""))+2+"px",X=parseInt(V.replace(n,""))+2+"px"):(H=t.find(".pro_price").css("color"),void 0!=(V=t.find(".pro_price").css("font-size"))&&(W=parseInt(V.replace(n,""))+2+"px",X=parseInt(V.replace(n,""))+2+"px"))}var G="";G=""==(G=1==a.find("input[name=top_style]:checked").val()?-1==(G=a.find("input[name=top_height]").val()).indexOf("%")?G.replace(n,"")+"%":G:t.parent(".sideContant").css("top"))?t.parent(".sideContant").css("top"):G;var U="";U=""==(U=1==a.find("input[name=margin_left_style]:checked").val()?-1==(U=a.find("input[name=margin_left_val]").val()).indexOf("%")?U.replace(n,"")+"px":U:t.parent(".sideContant").css("margin-left"))?t.parent(".sideContant").css("margin-left"):U,t.css({border:r,"border-radius":s,height:c,width:R,margin:u,padding:b,color:y,"font-size":x,background:I,"background-repeat":C,"background-color":w,"background-size":S}),"LI"==t[0].nodeName&&(t.find("p").css({color:L,"font-size":A,height:j,"line-height":D}),t.find(".pro_vip_price").css({color:M,"font-size":q,height:F,"line-height":N}),t.find(".pro_price").css({color:H,"font-size":V,height:W,"line-height":X})),"ul"==t&&"mainIcon-adv"==i?(t.css({height:c}),t.find("li").css({height:""}),t.parent(".module").css({background:I,"background-repeat":C,"background-color":w,"background-size":S})):(t.css({height:c}),t.parent("ul").css({height:""})),"mainIcon-pro"==i&&"li"==t[0].localName?(t.find("img").css({height:z,width:B}),t.css({height:"",width:R})):t.parent(".module").css({background:I,"background-repeat":C,"background-color":w,"background-size":S}),"mainIcon-floor"==i&&t.parent(".module").css({"border-radius":s,top:G,"margin-left":U})}function v(e,t,i,a,n){var o="";return o+='<tr class="image_item">',o+='<td style="vertical-align: middle;text-align: center;">'+e+"</td>",o+='<td style="vertical-align: middle;">',o+='<input class="sku_id" value="'+i+'" type="text" name="sku_id[]" placeholder="skuid/其他" style="width:100px;">',o+="</td>",o+='<td style="vertical-align: middle;max-width:120px;"><img style="width:80px;" src="'+t+'"></td>',o+='<td style="vertical-align: middle;">',o+='<select class="pic_target" name="pic_target[]">',o+=0==n?'<option value="0" selected="selected" >无</option>':'<option value="0" >无</option>',o+=1==n?'<option value="1" selected="selected" >商品</option>':'<option value="1">商品</option>',o+=2==n?'<option value="2" selected="selected" >店铺</option>':'<option value="2">店铺</option>',o+=3==n?'<option value="3" selected="selected" >专题活动页</option>':'<option value="3">专题活动页</option>',o+=4==n?'<option value="4" selected="selected" >其他自定义</option>':'<option value="4" >其他自定义</option>',o+="</select>",o+="</td>",o+='<td class="target_link" style="vertical-align: middle;">',o+='<input class="pic_link" value="'+a+'" type="text" name="pic_link[]" value="http://" readonly="readonly" placeholder="http://" style="min-width:350px;">',o+="</td>",o+="</tr>"}var g=(new Date).getTime(),_=openDatabase("pcCms","1.0","pcCms DB",2097152);_.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS pclist (pIndex,pTime,pStr)")}),e();var b=$("#setAllStyle").find(".modal-body").html();localStorage.setItem("setAllStyle",b);var y=$("#setStyle").find(".modal-body").html();localStorage.setItem("setStyle",y);new Swiper(".swiper-container",{pagination:".pagination",autoplay:2e3,speed:300,loop:!0,observer:!0,observeParents:!0,autoplayDisableOnInteraction:!1});$(".color").colorpicker();var x=/msie/i.test(navigator.userAgent)&&!window.opera;$("body").on("change",".more_pic",function(){if(x&&!$(this).files){var e=$(this).value;new ActiveXObject("Scripting.FileSystemObject").GetFile(e).Size}else for(var t=parseInt($(this).context.files.length),i=0,a=0;a<t;a++)if(parseInt($(this).context.files[a].size)/1024>200){$(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("图片不能超过200kb!");$(this).parents("td").html('<input  type="file" class="more_pic" name="more_pic[]" value="" multiple="" >'),n()}else i+=$(this).context.files[a].size}),n();var w=!1,k=[],I="";$(".image_upload").on("submit",function(e){var t=$(this),i=$(this).find("input[type=file]");e.preventDefault();var a=i.data("ace_input_files");if(!a||0==a.length)return!1;"FormData"in window&&(formData_object=new FormData,$.each($(this).serializeArray(),function(e,t){formData_object.append(t.name,t.value)}),$(this).find("input[type=file]").each(function(){var e=$(this).attr("name"),t=$(this).data("ace_input_files");if(t&&t.length>0)for(var i=0;i<t.length;i++)formData_object.append(e,t[i])}),w=!0,$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),processData:!1,contentType:!1,dataType:"json",data:formData_object,success:function(e){if(e.success){w=!1,k=e.data,console.log(k);for(val in k)I+="<li data-identify="+k[val].pic+'><img class="img-thumbnail" src="'+k[val].pic+'"/></li>';t.parent(".profile-info-value").next(".display_more_pic").html(""),t.parent(".profile-info-value").next(".display_more_pic").append(I),I="",$(".more_pic").val(),$("span.ace-file-container").empty().attr("data-title","请点击上传").append('<span class="ace-file-name" data-title="New File ..."><i class=" ace-icon fa fa-upload"></i></span>')}else bootbox.alert(e.msg)}}))}),$(".sidebar_modal").click(function(){$(this).hide(),$(this).parents(".header").next(".m_top").find(".modalPanelSidebar").show()}),$(".h_close").click(function(){$(this).parents(".modalPanelSidebar").hide(),$(this).parents(".m_top").prev(".header").find(".header_sidebar").find(".sidebar_modal").show()}),$("#setAllStyle").on("click",".choose_style",function(){0==$(this).val()?$(this).parents(".form-group").next(".form-group").hide():$(this).parents(".form-group").next(".form-group").show()}),$("#set_con_style").click(function(){var e=$(this).parent(".modal-footer").prev(".modal-body"),t=e.find("input[name=max_width_style]:checked").val(),a=$(".sideContant").css("width");a=void 0==a?"0px":a;var o="",l="";1==t?(o=e.find("input[name='con_width']").val().replace(/px/i,"")+"px",l=parseInt(o.replace(/px/i,""))+parseInt(a.replace(/px/i,""))+"px"):(o=$(".pcContant").css("width"),l=parseInt(o.replace(/px/i,""))+parseInt(a.replace(/px/i,""))+"px");var d="",s="",r="",c="",p="";switch(1==e.find("input[name=con_bg_style]:checked").val()?(d=e.find("input[name='con_bg_color']").val().replace(/px/i,""),p=parseInt(e.find("select[name='bgpic_style']").val()),s=e.find(".display_more_pic").find("li").attr("data-identify")):d=$(".mobiContant").css("background-color"),p){case 0:c="no-reapt";break;case 1:r="100% 100%",c="no-reapt";break;case 2:c="repeat-x";break;case 3:c="repeat-y"}$(".pcContant").css({width:o}),$(".midContant").css({width:l}),$(".sideContant").css({"margin-left":o}),$(".mobiReview").css({"min-width":l}),$(".pcContant").parents(".mobiContant").css({background:"url("+s+")","background-repeat":c,"background-color":d,"background-size":r}),$("#setAllStyle").modal("hide");$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();var m=$(".mobiReview").html();i("pContent",g,m);var f=localStorage.getItem("setAllStyle");$("#setAllStyle").find(".modal-body").html(f),$(".color").colorpicker(),n()}),$(".display_style").click(function(){$(this).find("div").attr("class","display_style_checked"),$(this).siblings().find("div").attr("class","")}),$(".add_btn").click(function(){var e=parseInt($(this).parents(".modal-body").find("input[name=floor_set]:checked").val());$(this).parent("p").next("form").find(".image_content").append(o(e)),n()}),$("input[name=floor_set]").click(function(){var e=parseInt($(this).val()),t=$(this).parents(".modal-body");0==e?(t.find(".image_item").find(".floor_id").parent("td").show(),t.find("thead").find("tr").find("th").first().show(),t.find(".image_content").html(o(e))):(t.find(".image_item").find(".floor_id").parent("td").hide(),t.find("thead").find("tr").find("th").first().hide(),t.find(".image_content").html(o(e))),n()});var S=$("input[name='url_item']").val(),C=$("input[name='url_store']").val(),P=$("input[name='url_sale_activity']").val();l("#mainIcon-more"),l("#mainIcon-adv"),d("#mainIcon-more"),d("#mainIcon-adv"),$(".add_btn_tr").click(function(){$(this).parent("p").next("form").find(".image_content").append('<tr class="image_item"><td style="vertical-align: middle;"><input class="sku_id" type="text" name="sku_id[]" placeholder="skuId" style="width:100px;"></td><td style="vertical-align: middle;max-width:120px;"><img class = "goodsimglogo" style="width:100%;" src=""></td><td style="vertical-align: middle;max-width:120px;"><input  type="file" class="more_pic" name="more_pic[]" multiple="" ></td><td style="vertical-align: middle;max-width:180px;"><h5><span  class="blue">商品名称：</span><span class="goodsname"></span></h5><h5><span  class="blue">活动价：</span><span class="goodsshopprice"></span></h5><h5><span  class="blue">原价：</span><span class="goodsmarketprice"></span></h5></td><td style="vertical-align: middle;"><select class="pic_target" name="pic_target[]"><option value="0">无</option><option value="1">商品</option></select></td><td class="target_link" style="vertical-align: middle;"><input class="pic_link" type="text" name="pic_link[]" value="http://" readonly="readonly" placeholder="http://" style="min-width:250px;"></td><td style="vertical-align: middle;text-align:center;"><i class="item_del red ace-icon fa fa-trash-o bigger-150"></i></td></tr>'),n()}),l("#mainIcon-pro"),d("#mainIcon-pro"),s("#mainIcon-more"),s("#mainIcon-adv"),s("#mainIcon-pro"),s("#modalEdit"),$("#mainIcon-pro").on("blur",".sku_id",function(){r($(this))}),function(e,t,i,l){$(e).click(function(){var e=$(this).next("p").html(),l=$("<div></div>"),d=$("<ul></ul>"),s=Math.floor(1e4*Math.random());l.attr("class","module module_"+s),d.attr("class","modulePanel "+t+" "+t+"_"+s),"顶部广告"==e?$(".pcContant").parent(".midContant").before(l):"内容广告"==e?$(".pcContant").append(l):$(".pcContant").parent(".midContant").after(l),$(".module_"+s).append(f()),$(".module_"+s).append(d),$(i).unbind("click").click(function(){var e=$(this).parents(".modal").find(".modal-body"),i=$(this),l=c(i);if(-1==$.inArray("0",l.arrTbImg))if(l.numTbLen==l.ulTbLen){var d=[];i.parents(".modal").find(".image_content").find(".image_item").each(function(){d.push($(this).find(".floor_id").val())});for(var r=d.join(",")+",",p=0;p<d.length;p++)if(r.replace(d[p]+",","").indexOf(d[p]+",")>-1)return $(".alert_txt").show(),void $(".alert_txt").find(".modal-body").html("楼层重复元素为"+d[p]+"请核对!");for(var m=$(this).parents(".modal").attr("id"),f=k.length,u="",p=0;p<f;p++)u='<li><a id="'+k[p].floor_id+'" href="'+k[p].pic_link+'"   data-target='+k[p].pic_target+'   target="_blank" class="open-goods-detail"  data-goods-id="'+k[p].sku_id+'"><img src="'+k[p].pic+'" data-lazy-src="'+k[p].pic+'"></a></li>',$("."+t+"_"+s).append(u),$("."+t+"_"+s).attr("data-id",m);var v=[];$("."+t+"_"+s).find("li").each(function(){v.push($(this).find("img").height())}),$("."+t+"_"+s).find("li").each(function(){$(this).prepend(h())}),e.find("input[name=floor_set]").each(function(){0==parseInt($(this).val())?$(this).prop("checked",!1):$(this).prop("checked","checked")}),e.find("thead").find("tr").find("th").first().hide(),$(this).parent(".modal-footer").prev(".modal-body").find(".image_content").html(o()),$(this).parent(".modal-footer").prev(".modal-body").find(".display_more_pic").html(""),n();var g=$(".mobiContant").find(".module").length;$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove(),a("pContent",g,$(".mobiReview").html()),a("module_"+s,"",$(".module_"+s).html()),$("#"+m).modal("hide")}else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("请上传参数!");else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("参数不能为空!")})})}(".mainIcon-adv","adv_pic","#save_adv_pic"),$(".mainIcon-more").click(function(){void 0!=$(".mobiContant").find("#module_more").html()&&$(".mobiContant").find("#module_more").remove();$(".mobiContant").prepend('<div id="module_more" class="module module_1101"><div class="swiper-container modulePanel" data-id="mainIcon-more"><div class="swiper-wrapper"></div><div class="pagination"></div></div></div>'),$(".mobiContant").find("#module_more").prepend(f()),$("#save_more_pic").unbind("click").click(function(){var e=$(this),t=c(e),i=$(this).parents(".modal").attr("id");if(-1==$.inArray("",t.arrTbVal)&&-1==$.inArray("0",t.arrTbImg))if(t.numTbLen==t.ulTbLen){var l=[];e.parent(".modal-footer").prev(".modal-body").find(".image_content").find(".image_item").each(function(){var e=$(this).find(".sku_id").val();l.push(e)}),console.log(l);for(var d=l.join(",")+",",s=0;s<l.length;s++)if(d.replace(l[s]+",","").indexOf(l[s]+",")>-1)return $(".alert_txt").show(),void $(".alert_txt").find(".modal-body").html("楼层重复元素为"+l[s]+"请核对!");$(".swiper-container").show();for(var r=k.length,p="",s=0;s<r;s++)p+='<div class="swiper-slide"> <a href="'+k[s].pic_link+'"   data-target='+k[s].pic_target+'  target="_blank" class="open-goods-detail"  data-goods-id="'+k[s].sku_id+'"><img src="'+k[s].pic+'"> </a> </div>';$(".swiper-wrapper").html(p),$(".swiper-wrapper").parent(".swiper-container").attr("data-id",i);var m=[];$(".swiper-wrapper").find(".swiper-slide").each(function(){m.push($(this).find("img").height())});var f="";f=Math.min.apply(null,m),$(".swiper-wrapper").parent(".swiper-container").css({height:f}),$(this).parent(".modal-footer").prev(".modal-body").find(".image_content").html(o(1)),$(this).parent(".modal-footer").prev(".modal-body").find(".display_more_pic").html(""),n();var h=$(".mobiContant").find(".module").length;$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();a("pContent",h,$(".mobiReview").html());$("#module_more").find(".swiper-slide-duplicate").remove();a("module_1101","",$("#module_more").html()),$("#"+i).modal("hide")}else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("请上传参数!");else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("参数不能为空!")})}),$(".mainIcon-pro").click(function(){var e=$("<div></div>"),t=$("<ul></ul>"),i=Math.floor(1e4*Math.random());e.attr("class","module module_"+i),t.attr("class","modulePanel list_more_v list_more_v_"+i),$(".pcContant").append(e),$(".module_"+i).append(f()),$(".module_"+i).append(t),$("#save_pro_pic").unbind("click").click(function(){var e=$(this),t=c(e),o=$(this).parents(".modal").attr("id"),l=parseInt($("input[name=goods_info]:checked").val());if(-1==$.inArray("",t.arrTbVal)&&-1==$.inArray("0",t.arrTbImg))if(t.numTbLen==t.ulTbLen){var d=[],s={},r=[];e.parent(".modal-footer").prev(".modal-body").find(".image_content").find(".image_item").each(function(){var e=$(this).find(".sku_id").val(),t=$(this).find(".pic_link").val();s={sku_id:e,pic:"",S_Link:t},d.push(s),r.push(e)});for(var p=r.join(",")+",",m=0;m<r.length;m++)if(p.replace(r[m]+",","").indexOf(r[m]+",")>-1)return $(".alert_txt").show(),void $(".alert_txt").find(".modal-body").html("楼层重复元素为"+r[m]+"请核对!");k.forEach(function(e,t,i){d.forEach(function(t){e.sku_id==t.sku_id&&(t.pic=e.pic)})});var f="";$.ajax({url:"/pc/getgoods.html",type:"POST",dataType:"json",async:!1,data:{sku_id:d},success:function(e){for(var t=e.data,i=0;i<t.length;i++)f+="<li>",void 0!=k[i]?f+='<a href="'+t[i].S_Link+'" data-target='+k[i].pic_target+' target="_blank" class="open-goods-detail"  data-goods-id="'+t[i].Sku_ID+'">':f+='<a href="'+t[i].S_Link+'" data-target='+t[i].S_Link+' target="_blank" class="open-goods-detail"  data-goods-id="'+t[i].Sku_ID+'">',f+='<img src="'+t[i].S_Logo+'" data-lazy-src="'+t[i].S_Logo+'"/>',0==l&&(f+="<p>"+t[i].S_Name+"</p>",f+="<div>",f+='<span class="pro_vip_price">￥'+t[i].S_ShopPrice+"</span>",f+='<span class="pro_price">￥'+t[i].S_MarketPrice+"</span>",f+="</div>"),f+="</a>",f+="</li>"}}),$(".list_more_v_"+i).append(f),$(".list_more_v_"+i).attr("data-id",o);var u="",v="",g="";switch($("#mainIcon-pro").find(".display_style").each(function(){var e=$(this).find(".display_style_checked").attr("data-id");void 0!=e&&(u=parseInt(e))}),u){case 2:v="50%";break;case 3:v="33.33%";break;case 4:v="25%";break;case 5:v="20%"}$(".edit_part_modal").html("");for(var g="",m=0;m<k.length;m++)g+='<img src="'+k[m].pic+'"/>';$(".edit_part_modal").html(g);var _=[],b=[];$(".edit_part_modal").find("img").each(function(e,t){var i=t.width,a=t.height;_.push(i),b.push(a)});var y="",x="";y=Math.min.apply(null,_),x=Math.min.apply(null,b),$(".module_"+i).width()*parseFloat(v)/100>y?$(".list_more_v_"+i).find("li").each(function(){$(this).find("img").css({width:y,height:x})}):$(".list_more_v_"+i).find("li").each(function(){$(this).find("img").css({width:"100%",height:x})}),$(".list_more_v_"+i).find("li").css({width:v}),$(".list_more_v_"+i).find("li").each(function(){$(this).prepend(h())}),$(this).parent(".modal-footer").prev(".modal-body").find(".image_content").html('<tr class="image_item"><td style="vertical-align: middle;"><input class="sku_id" type="text" name="sku_id[]" placeholder="skuId" style="width:100px;"></td><td style="vertical-align: middle;max-width:120px;"><img class = "goodsimglogo" style="width:100%;" src=""></td><td style="vertical-align: middle;max-width:120px;"><input  type="file" class="more_pic" name="more_pic[]" multiple="" ></td><td style="vertical-align: middle;max-width:180px;"><h5><span  class="blue">商品名称：</span><span class="goodsname"></span></h5><h5><span  class="blue">活动价：</span><span class="goodsshopprice"></span></h5><h5><span  class="blue">原价：</span><span class="goodsmarketprice"></span></h5></td><td style="vertical-align: middle;"><select class="pic_target" name="pic_target[]"><option value="0">无</option><option value="1">商品</option></select></td><td class="target_link" style="vertical-align: middle;"><input class="pic_link" type="text" name="pic_link[]" value="http://" readonly="readonly" placeholder="http://" style="min-width:250px;"></td><td style="vertical-align: middle;text-align:center;"><i class="item_del red ace-icon fa fa-trash-o bigger-150"></i></td></tr>'),$(this).parent(".modal-footer").prev(".modal-body").find(".display_more_pic").html(""),n();var w=$(".mobiContant").find(".module").length;$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();a("pContent",w,$(".mobiReview").html());a("module_"+i,"",$(".module_"+i).html()),$("#"+o).modal("hide")}else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("请上传参数!");else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("参数不能为空!")})}),$(".add_btn_floor").click(function(){var e=$(this).parent("p").next("form").find(".image_content").find("tr").last().find("td").first().html();e=void 0==e?0:parseInt(e),e+=1,$(this).parent("p").next("form").find(".image_content").append(p(e))}),d("#mainIcon-floor"),$("#mainIcon-floor").on("blur",".floor_id",function(){var e=/^[0-9a-zA-a]*$/g,t=$(this).val();e.test(t)||($(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("请输入数字、字母!"),$(this).val(""))}),$("#mainIcon-floor").on("blur",".floor_name",function(){var e=/^[\u4e00-\u9fa5a-zA-Z0-9]+$/g,t=$(this).val();e.test(t)||($(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("请输入数字、字母、中文!"),$(this).val(""))}),$(".mainIcon-floor").click(function(){var e=$("<ul></ul>"),t=$('<div class="sideContant module module_666" style="display: none"></div>');e.attr("class","modulePanel side_floor side_floor_666"),$("#save_floor").unbind("click").click(function(){void 0==$(".sideContant").html()?$(".mobiReview").find(".midContant").find(".pcContant").append(t):$(".sideContant").show();var i=$(this).parent(".modal-footer").prev(".modal-body"),n=i.find("input[name=floor_display]:checked").val(),o="",l="",d="",s=[];i.find(".image_content").find(".image_item").each(function(){s.push($(this).find(".floor_id").val())});for(var r=s.join(",")+",",c=0;c<s.length;c++)if(r.replace(s[c]+",","").indexOf(s[c]+",")>-1)return $(".alert_txt").show(),void $(".alert_txt").find(".modal-body").html("楼层重复元素为"+s[c]+"请核对!");if(0==n){var f=[];if(i.find(".image_content").find(".image_item").each(function(){f.push($(this).find(".floor_id").val())}),i.find(".image_content").find(".image_item").each(function(){f.push($(this).find(".floor_name").val())}),-1==f.indexOf("")){$(".sideContant").show(),l=$(".pcContant").width(),d=150;var h="";i.find(".image_content").find("tr").each(function(){h+='<li><a href="#'+$(this).find(".floor_id").val()+'">'+$(this).find(".floor_name").val()+"</a></li>"}),$(".sideContant").html(""),$(".module_666").append(m()),$(".module_666").append(e),e.attr("data-id","mainIcon-floor"),e.append(h),$("#mainIcon-floor").modal("hide"),i.find(".image_content").html(p(1))}else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("楼层Id或名称不能为空,请核对!")}else $(".sideContant").hide(),$(".sideContant").html(""),l=$(".pcContant").width(),d=0,$("#mainIcon-floor").modal("hide");o=l+d,$(".pcContant").css({width:l+"px"}),$(".midContant").css({width:o+"px"}),$(".sideContant").css({"margin-left":l+"px",width:d+"px"});var u=$(".mobiContant").find(".module").length;$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();a("pContent",u,$(".mobiReview").html());a("sideContant","",$(".sideContant").html())})}),$(".mobiReview").on("mouseover",".module",function(e){$(this).find(".modulePanel").attr("data-id"),$(this).index(),$(this).find(".modulePanelBg").addClass("modulePanelHover"),$(this).find(".modulePanel").find("li").find(".moduleItemBg").addClass("moduleActionBtn")}),$(".mobiReview").on("mouseout",".module",function(e){$(this).find(".modulePanelBg").removeClass("modulePanelHover"),$(this).find(".modulePanel").find("li").find(".moduleItemBg").removeClass("moduleActionBtn")}),$(".mobiReview").on("click",".module_del",function(){$(".alert").show();var e=$(this),t=e.parents(".modulePanelBg").parent(".module").attr("id");console.log(t),$(".suc_btn").unbind("click").click(function(){$(".alert").hide(),e.parents(".modulePanelBg").parent(".module").remove();$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();var t=$(".mobiReview").html();i("pContent",g,t)})}),$(".mobiReview").on("click",".module_up",function(){var e=$(this).parents(".module");$(this).parents(".module").prev(".module").before(e),$(this).parents(".modulePanelBg").removeClass("modulePanelHover");$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();var t=$(".mobiReview").html();i("pContent",g,t)}),$(".mobiReview").on("click",".module_down",function(){var e=$(this).parents(".module");$(this).parents(".module").next(".module").after(e),$(this).parents(".modulePanelBg").removeClass("modulePanelHover");$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();var t=$(".mobiReview").html();i("pContent",g,t)}),$(".alert_close").click(function(){$(".alert").hide(),$(".alert_txt").hide()}),$("#setStyle").on("blur","input[type=text]",function(){var e=/^[0-9a-zA-a#%]*$/g,t=$(this).val();e.test(t)||($(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("请输入数字、字母!"),$(this).val(""))}),$("#setStyle").on("click",".ruleSettingTab",function(){$(".basicSetting").show(),$(".contentSetting").hide(),$(".topLevelSetting").hide(),$(".sideSetting").hide()}),$("#setStyle").on("click",".contentSettingTab",function(){$(".contentSetting").show(),$(".basicSetting").hide(),$(".topLevelSetting").hide(),$(".sideSetting").hide()}),$("#setStyle").on("click",".topLevelSettingTab",function(){$(".topLevelSetting").show(),$(".basicSetting").hide(),$(".contentSetting").hide(),$(".sideSetting").hide()}),$("#setStyle").on("click",".sideSettingTab",function(){$(".topLevelSetting").hide(),$(".basicSetting").hide(),$(".contentSetting").hide(),$(".sideSetting").show()}),$("#setStyle").on("click",".choose_style",function(){0==$(this).val()?$(this).parents(".form-group").next(".form-group").hide():$(this).parents(".form-group").next(".form-group").show()});$(".mobiReview").on("click",".set_module",function(){-1!=$(this).parent().attr("class").indexOf("modulePanelBg")&&$(".topLevelSettingTab").hide();var e=$(this).parent(".modulePanelBg").next(".modulePanel"),t=$(this).parent(".modulePanelBg").next(".modulePanel").attr("data-id");"mainIcon-floor"==t?$(".sideSettingTab").show():$(".sideSettingTab").hide(),console.log(t),$("#set_module_style").unbind("click").click(function(){u($(this),e,t);$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();var a=$(".mobiReview").html();i("pContent",g,a);var o=localStorage.getItem("setStyle");$("#setStyle").find(".modal-body").html(o),$(".color").colorpicker(),n()})});$(".mobiReview").on("click",".moduleItemDel",function(){$(".alert").show();var e=$(this);$(".suc_btn").unbind("click").click(function(){$(".alert").hide(),e.parents("li").remove();$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();var t=$(".mobiReview").html();i("pContent",g,t)})}),$(".mobiReview").on("click",".moduleItemEdit",function(){$(this).parents("li");var e=$(this).parent().attr("class");console.log(e),-1==e.indexOf("modulePanelBg")&&($(".topLevelSettingTab").show(),$(".sideSettingTab").hide());var t=$(this).parents("li"),a=$(this).parent(".moduleItemBg").parents("ul").attr("data-id");$("#set_module_style").unbind("click").click(function(){u($(this),t,a);$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();var e=$(".mobiReview").html();i("pContent",g,e);var o=localStorage.getItem("setStyle");$("#setStyle").find(".modal-body").html(o),$(".color").colorpicker(),n()})}),$(".mobiReview").on("click",".edit_module",function(){$(".edit_part_modal").html(""),$("#modalEdit").find(".image_content").html("");var e=$(this).parent(".modulePanelBg").next().attr("data-id"),t="";switch(e){case"mainIcon-more":t="轮播图";break;case"mainIcon-adv":t="广告图";break;case"mainIcon-pro":t="产品展示"}$(".modalName").html(t);var i=$(this).parents(".module").attr("class"),o=(i=i.split(" "))[1];_.transaction(function(t){t.executeSql('SELECT * FROM pclist WHERE pIndex = "'+o+'"',[],function(t,i){if(console.log("查询数据成功!"),i.rows.length>0){var l=i.rows[0].pStr;if($(".edit_part_modal").html(l),"mainIcon-more"==e||"mainIcon-adv"==e){$("#modalEdit").find("thead").find(".changeView").hide();d=0;$(".edit_part_modal").find(".modulePanel").find(".open-goods-detail").each(function(){d+=1;var e=$(this).attr("data-goods-id"),t=$(this).find("img").attr("src"),i=$(this).attr("href"),a=parseInt($(this).attr("data-target"));$("#modalEdit").find(".image_content").append(v(d,t,e,i,a)),n()}),$("#save_modal_edit").click(function(){var t=$(this).parents("#modalEdit").find(".image_content"),i=[];if(t.find(".sku_id").each(function(){i.push($(this).val())}),console.log(i),-1==$.inArray("",i)){if("mainIcon-more"!=e)t.find("tr").each(function(){var e=$(this).find(".sku_id").val(),t=$(this).find(".pic_target").val(),i=$(this).find(".pic_link").val();$("."+o).find("li").eq(""+$(this).index()).find(".open-goods-detail").attr("data-goods-id",e),$("."+o).find("li").eq(""+$(this).index()).find(".open-goods-detail").attr("data-target",t),$("."+o).find("li").eq(""+$(this).index()).find(".open-goods-detail").attr("href",i)});else{var n="";t.find("tr").each(function(){var e=$(this).find(".sku_id").val(),t=$(this).find("img").attr("src"),i=$(this).find(".pic_target").val(),a=$(this).find(".pic_link").val();n+='<div class="swiper-slide"> <a href="'+a+'" class="open-goods-detail" data-target="'+i+'"  data-goods-id="'+e+'"><img src="'+t+'"> </a> </div>'}),$(".module_1101").find(".swiper-wrapper").html(n)}var l=$(".mobiContant").find(".module").length;$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();a("pContent",l,$(".mobiReview").html());a(o,"",$("."+o).html()),$("#modalEdit").modal("hide")}else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("参数不能为空!")})}else{var d=0;$(".edit_part_modal").find(".modulePanel").find(".open-goods-detail").each(function(){d+=1;var e=$(this).attr("data-goods-id"),t=$(this).find("img").attr("src"),i=$(this).attr("href"),a=parseInt($(this).attr("data-target"));$("#modalEdit").find(".image_content").append(v(d,t,e,i,a)),n()}),$("#save_modal_edit").click(function(){var e=$(this).parents("#modalEdit").find(".image_content"),t=[];if(e.find("input[type=text]").each(function(){t.push($(this).val())}),-1==$.inArray("",t)){e.find("tr").each(function(){var e=$(this).find(".sku_id").val(),t=$(this).find(".pic_target").val(),i=$(this).find(".pic_link").val();$("."+o).find("li").eq(""+$(this).index()).find(".open-goods-detail").attr("data-goods-id",e),$("."+o).find("li").eq(""+$(this).index()).find(".open-goods-detail").attr("data-target",t),$("."+o).find("li").eq(""+$(this).index()).find(".open-goods-detail").attr("href",i)});var i=$(".mobiContant").find(".module").length;$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove();a("pContent",i,$(".mobiReview").html());a(o,"",$("."+o).html()),$("#modalEdit").modal("hide")}else $(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("参数不能为空!")})}}},function(e,t){console.log(t.source+"::"+t.message)})})}),l("#modalEdit"),$(".save_all").click(function(){$(".mobiContant").find("#module_more").find(".swiper-slide-duplicate").remove(),$(".mobiContant").find(".module").find(".modulePanelBg").remove(),$(".mobiContant").find(".module").find(".modulePanel").find(".moduleItemBg").remove();$(".mobiReview").find(".module_666").find(".modulePanelBg").remove(),$(".m_top").find(".modalPanelSidebar").remove();var e=$(".mobiContant").parent().html(),t=$("#S_Code").val();$.base64.utf8encode=!0;var i=$.base64.btoa(t);console.log(i);var a=$("input[name='url_sale']").val();$.ajax({url:"/pc/save.html?S_Code="+t,type:"POST",dataType:"json",data:{save_AllData:e,value_cms:i},success:function(e){e.success?($(".alert_txt").show(),$(".alert_txt").find(".modal-body").html(e.msg),_.transaction(function(e){e.executeSql("drop table pclist")}),window.location.href=a+"activity/add.html?S_Code="+t+"&value="+i):($(".alert_txt").show(),$(".alert_txt").find(".modal-body").html("保存失败！"))}})});$(".mobiReview").find(".module").each(function(){var e=$(this);void 0==e.find("modulePanelBg").html()&&e.prepend('<div class="modulePanelBg"><button data-toggle="modal" data-target="#modalEdit" class="edit_module btn btn-primary btn-xs ">编辑模块</button><button data-toggle="modal" data-target="#setStyle" class="set_module btn btn-primary btn-xs ">设置样式</button><div class="moduleBtn action-buttons"><span class="module_del"><a><i class="fa fa-times" aria-hidden="true"></i></a></span><span class="module_up"><a><i class="fa fa-long-arrow-up" aria-hidden="true"></i></a></span><span class="module_down"><a><i class="fa fa-long-arrow-down" aria-hidden="true"></i></a></span></div></div>')}),$(".mobiReview").find(".module_666").find(".modulePanelBg").remove(),$(".mobiReview").find(".module_666").prepend('<div class="modulePanelBg"><button data-toggle="modal" data-target="#setStyle" class="set_module btn btn-primary btn-xs ">设置样式</button></div>'),$(".mobiReview").find(".module").find(".modulePanel").find("li").each(function(){var e=$(this);void 0==e.find("moduleItemBg").html()&&e.prepend('<a class="moduleItemBg"><span data-toggle="modal" data-target="#setStyle" class="moduleItemEdit"><i class="fa fa-pencil" aria-hidden="true"></i></span><span class="moduleItemDel"><i class="fa fa-times" aria-hidden="true"></i></span></a>')}),$(".mobiReview").find(".module_666").find(".modulePanel").find("li").each(function(){$(this).find(".moduleItemBg").remove()})});